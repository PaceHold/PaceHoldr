<!doctype html>
<html>
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Transaction</title><link rel="stylesheet" href="style.css"></head>
<body>
  <header class="topbar"><div class="brand">PaceHold</div></header>
  <main style="padding:18px">
    <div class="card">
      <h3>Quick Transaction</h3>
      <input id="txSellerUid" placeholder="Seller UID" />
      <input id="txAmount" type="number" placeholder="Amount (â‚¦)" />
      <input id="txDescription" placeholder="Description" />
      <button id="txPayBtn" class="primary">Pay with Paystack</button>
    </div>
  </main>

  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://js.paystack.co/v1/inline.js"></script>
  <script src="firebase-config.js"></script>
  <script src="auth.js"></script>
  <script src="escrow.js"></script>

  <script>
    document.getElementById('txPayBtn').addEventListener('click', async ()=>{
      const sellerUid = document.getElementById('txSellerUid').value.trim();
      const amount = Number(document.getElementById('txAmount').value);
      const desc = document.getElementById('txDescription').value || 'Escrow';
      if(!sellerUid) return alert('Enter seller uid');
      if(!amount) return alert('Enter amount');
      const user = auth.currentUser;
      if(!user) return alert('Login first');
      const handler = PaystackPop.setup({
        key: 'PAYSTACK_PUBLIC_KEY_HERE',
        email: user.email,
        amount: Math.round(amount * 100),
        currency: 'NGN',
        callback: async function(response){
          await createTransaction({ buyerUid: user.uid, sellerUid, amount, reference: response.reference, description: desc });
          alert('Transaction created: ' + response.reference);
        },
        onClose: function(){ alert('Cancelled'); }
      });
      handler.openIframe();
    });
  </script>
</body>
</html>
